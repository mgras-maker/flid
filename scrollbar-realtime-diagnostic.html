<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Diagnostyka scrollbara w czasie rzeczywistym</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .diagnostic-panel {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 16px 0;
        }
        
        .status-item {
            padding: 12px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            border: 2px solid;
            transition: all 0.3s ease;
        }
        
        .good { 
            background: #e8f5e8; 
            color: #2e7d32; 
            border-color: #4CAF50;
        }
        
        .warning { 
            background: #fff3e0; 
            color: #f57c00; 
            border-color: #FF9800;
            animation: pulse 2s infinite;
        }
        
        .error { 
            background: #ffebee; 
            color: #c62828; 
            border-color: #F44336;
            animation: shake 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-weight: 500;
            transition: transform 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        .real-time-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 11px;
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #333;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 2px 0;
        }
        
        .timestamp { color: #888; }
        .critical { color: #ff6b6b; font-weight: bold; }
        .warning-log { color: #ffa726; }
        .success-log { color: #66bb6a; }
        .info-log { color: #42a5f5; }
        
        .measurement-box {
            border: 2px dashed #666;
            padding: 16px;
            margin: 16px 0;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
        }
        
        .scrollbar-detector {
            position: fixed;
            top: 0;
            right: 0;
            width: 200px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px;
            font-size: 10px;
            z-index: 9999;
            border-radius: 0 0 0 8px;
        }
    </style>
</head>
<body>
    <div class="scrollbar-detector" id="detector">
        <div>üîç Detektor scrollbara</div>
        <div id="detector-status">Monitorowanie...</div>
    </div>

    <h1>üîç Diagnostyka scrollbara w czasie rzeczywistym</h1>
    <p>Zaawansowane narzƒôdzie do ≈õledzenia pojawienia siƒô dodatkowego scrollbara</p>
    
    <div class="diagnostic-panel">
        <h3>üìä Status systemu scrollbara</h3>
        <div class="status-grid">
            <div id="scrollbar-width" class="status-item">≈Åadowanie...</div>
            <div id="viewport-width" class="status-item">≈Åadowanie...</div>
            <div id="document-width" class="status-item">≈Åadowanie...</div>
            <div id="overflow-status" class="status-item">≈Åadowanie...</div>
        </div>
        
        <div class="measurement-box">
            <strong>Pomiary w czasie rzeczywistym:</strong>
            <div id="measurements">Inicjalizacja...</div>
        </div>
    </div>
    
    <div class="diagnostic-panel">
        <h3>üéØ Kontrola test√≥w</h3>
        <button onclick="openMainApp()">üöÄ Otw√≥rz g≈Ç√≥wnƒÖ aplikacjƒô</button>
        <button onclick="refreshMainApp()">üîÑ Od≈õwie≈º g≈Ç√≥wnƒÖ aplikacjƒô</button>
        <button onclick="startContinuousMonitoring()">üì° Rozpocznij ciƒÖg≈Çe monitorowanie</button>
        <button onclick="simulateScrollbarFlash()">‚ö° Symuluj miganie scrollbara</button>
        <button onclick="takeSnapshot()">üì∏ Zr√≥b snapshot</button>
        <button onclick="clearLog()">üóëÔ∏è Wyczy≈õƒá log</button>
    </div>
    
    <div class="diagnostic-panel">
        <h3>üìù Log w czasie rzeczywistym</h3>
        <div id="realtime-log" class="real-time-log">
            <div class="log-entry info-log">
                <span class="timestamp">[INIT]</span> System diagnostyczny uruchomiony
            </div>
        </div>
    </div>

    <script>
        let monitoringActive = false;
        let measurements = [];
        let lastScrollbarState = null;
        
        function log(message, type = 'info') {
            const logContainer = document.getElementById('realtime-log');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            
            const icons = {
                'critical': 'üö®',
                'warning': '‚ö†Ô∏è',
                'success': '‚úÖ',
                'info': '‚ÑπÔ∏è'
            };
            
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-log`;
            entry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${icons[type] || '‚ÑπÔ∏è'} ${message}`;
            
            logContainer.insertBefore(entry, logContainer.firstChild);
            
            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
            
            // Auto-scroll to top
            logContainer.scrollTop = 0;
        }
        
        function measureScrollbar() {
            const windowWidth = window.innerWidth;
            const documentWidth = document.documentElement.clientWidth;
            const scrollbarWidth = windowWidth - documentWidth;
            
            const htmlStyle = getComputedStyle(document.documentElement);
            const bodyStyle = getComputedStyle(document.body);
            
            return {
                hasScrollbar: scrollbarWidth > 0,
                scrollbarWidth: scrollbarWidth,
                windowWidth: windowWidth,
                documentWidth: documentWidth,
                htmlOverflow: htmlStyle.overflowY,
                bodyOverflow: bodyStyle.overflowY,
                htmlScrollbarWidth: htmlStyle.scrollbarWidth,
                timestamp: Date.now()
            };
        }
        
        function updateStatus() {
            const measurement = measureScrollbar();
            measurements.push(measurement);
            
            // Keep only last 100 measurements
            if (measurements.length > 100) {
                measurements.shift();
            }
            
            // Update status boxes
            document.getElementById('scrollbar-width').innerHTML = `
                <strong>Scrollbar Width:</strong><br>
                ${measurement.scrollbarWidth}px
                ${measurement.hasScrollbar ? '‚ö†Ô∏è DETECTED' : '‚úÖ NONE'}
            `;
            document.getElementById('scrollbar-width').className = `status-item ${measurement.hasScrollbar ? 'warning' : 'good'}`;
            
            document.getElementById('viewport-width').innerHTML = `
                <strong>Viewport:</strong><br>
                Window: ${measurement.windowWidth}px<br>
                Document: ${measurement.documentWidth}px
            `;
            document.getElementById('viewport-width').className = 'status-item good';
            
            document.getElementById('overflow-status').innerHTML = `
                <strong>Overflow Settings:</strong><br>
                HTML: ${measurement.htmlOverflow}<br>
                Body: ${measurement.bodyOverflow}<br>
                Scrollbar-width: ${measurement.htmlScrollbarWidth}
            `;
            document.getElementById('overflow-status').className = 'status-item good';
            
            // Update detector
            const detector = document.getElementById('detector-status');
            detector.innerHTML = `
                Status: ${measurement.hasScrollbar ? 'üö® SCROLLBAR' : '‚úÖ CLEAN'}<br>
                Width: ${measurement.scrollbarWidth}px<br>
                Time: ${new Date().toLocaleTimeString()}
            `;
            
            // Check for changes
            if (lastScrollbarState !== null && lastScrollbarState !== measurement.hasScrollbar) {
                if (measurement.hasScrollbar) {
                    log(`üö® SCROLLBAR POJAWI≈Å SIƒò! Szeroko≈õƒá: ${measurement.scrollbarWidth}px`, 'critical');
                } else {
                    log(`‚úÖ Scrollbar zniknƒÖ≈Ç`, 'success');
                }
            }
            
            lastScrollbarState = measurement.hasScrollbar;
            
            // Update measurements display
            const measurementsDiv = document.getElementById('measurements');
            measurementsDiv.innerHTML = `
                Ostatni pomiar: ${new Date().toLocaleTimeString()}<br>
                Scrollbar: ${measurement.hasScrollbar ? 'TAK' : 'NIE'} (${measurement.scrollbarWidth}px)<br>
                Viewport: ${measurement.windowWidth}px / ${measurement.documentWidth}px<br>
                Overflow: HTML(${measurement.htmlOverflow}) Body(${measurement.bodyOverflow})
            `;
        }
        
        function startContinuousMonitoring() {
            if (monitoringActive) {
                log('Monitorowanie ju≈º aktywne', 'warning');
                return;
            }
            
            monitoringActive = true;
            log('üöÄ Rozpoczƒôto ciƒÖg≈Çe monitorowanie scrollbara', 'success');
            
            // Monitor every 100ms
            const interval = setInterval(() => {
                if (!monitoringActive) {
                    clearInterval(interval);
                    return;
                }
                updateStatus();
            }, 100);
            
            // Also monitor on various events
            ['scroll', 'resize', 'load', 'DOMContentLoaded'].forEach(event => {
                window.addEventListener(event, () => {
                    if (monitoringActive) {
                        updateStatus();
                        log(`Event detected: ${event}`, 'info');
                    }
                });
            });
        }
        
        function openMainApp() {
            log('Otwieranie g≈Ç√≥wnej aplikacji...', 'info');
            const mainWindow = window.open('http://localhost:3005', 'mainapp', 'width=1200,height=800');
            
            if (mainWindow) {
                log('‚úÖ G≈Ç√≥wna aplikacja otwarta w nowym oknie', 'success');
                
                // Try to monitor the main window
                try {
                    mainWindow.addEventListener('load', () => {
                        log('üìÑ G≈Ç√≥wna aplikacja za≈Çadowana', 'info');
                    });
                } catch (e) {
                    log('‚ö†Ô∏è Nie mo≈ºna monitorowaƒá g≈Ç√≥wnego okna (CORS)', 'warning');
                }
            } else {
                log('‚ùå Nie uda≈Ço siƒô otworzyƒá g≈Ç√≥wnej aplikacji', 'critical');
            }
        }
        
        function refreshMainApp() {
            log('Pr√≥ba od≈õwie≈ºenia g≈Ç√≥wnej aplikacji...', 'info');
            try {
                const mainWindow = window.open('http://localhost:3005', 'mainapp');
                if (mainWindow) {
                    setTimeout(() => {
                        mainWindow.location.reload();
                        log('üîÑ G≈Ç√≥wna aplikacja od≈õwie≈ºona', 'success');
                    }, 100);
                }
            } catch (e) {
                log('‚ùå B≈ÇƒÖd podczas od≈õwie≈ºania: ' + e.message, 'critical');
            }
        }
        
        function simulateScrollbarFlash() {
            log('‚ö° Symulowanie migania scrollbara...', 'warning');
            
            // Create temporary content to force scrollbar
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                height: 200vh;
                width: 100%;
                background: linear-gradient(to bottom, transparent, rgba(255,0,0,0.1));
                position: absolute;
                top: 0;
                left: 0;
                z-index: -1;
            `;
            document.body.appendChild(tempDiv);
            
            updateStatus();
            
            setTimeout(() => {
                document.body.removeChild(tempDiv);
                updateStatus();
                log('‚úÖ Symulacja zako≈Ñczona', 'success');
            }, 2000);
        }
        
        function takeSnapshot() {
            const measurement = measureScrollbar();
            log(`üì∏ Snapshot: Scrollbar=${measurement.hasScrollbar}, Width=${measurement.scrollbarWidth}px, Time=${new Date().toLocaleTimeString()}`, 'info');
        }
        
        function clearLog() {
            document.getElementById('realtime-log').innerHTML = `
                <div class="log-entry info-log">
                    <span class="timestamp">[CLEAR]</span> ‚ÑπÔ∏è Log wyczyszczony
                </div>
            `;
            log('üóëÔ∏è Log wyczyszczony', 'info');
        }
        
        // Initialize
        updateStatus();
        startContinuousMonitoring();
        
        log('üîç Diagnostyka scrollbara zainicjalizowana', 'success');
        log('üí° Otw√≥rz g≈Ç√≥wnƒÖ aplikacjƒô i od≈õwie≈º jƒÖ, aby wykryƒá miganie scrollbara', 'info');
    </script>
</body>
</html>
